<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Imports - ×—×©×‘×•× ×™×•×ª ×•×ª×¢×•×“×•×ª ××©×œ×•×—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Heebo', sans-serif; }
        .gold-gradient { background: linear-gradient(135deg, #c9a227 0%, #d4af37 50%, #e6c84b 100%); }
        
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 32px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            animation: slideDown 0.3s ease;
        }
        .toast.success { background: #10B981; }
        .toast.error { background: #EF4444; }
        @keyframes slideDown {
            from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        @media print {
            body * { visibility: hidden; }
            #printArea, #printArea * { visibility: visible; }
            #printArea { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
        }
        
        .sidebar { width: 200px; min-height: 100vh; position: fixed; right: 0; top: 0; }
        .main-content { margin-right: 200px; }
        .nav-item { display: flex; align-items: center; gap: 10px; padding: 12px 16px; color: white; transition: all 0.3s; }
        .nav-item:hover { background: rgba(255,255,255,0.1); }
        .nav-item.active { background: linear-gradient(135deg, #c9a227 0%, #d4af37 50%, #e6c84b 100%); }
        
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }
        .modal-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }
    </style>
</head>
<body class="bg-gray-100">
    
    <div id="toastContainer"></div>

    <!-- ×¡×¨×’×œ ×¦×“ -->
    <aside class="sidebar bg-gray-800 shadow-xl">
        <div class="p-4 border-b border-gray-700">
            <div class="flex items-center gap-3">
                <img src="logo.jpeg" alt="Logo" class="w-12 h-12 object-contain">
                <div>
                    <h1 class="text-white font-bold">Global Imports</h1>
                    <p class="text-gray-400 text-xs">Premium Hair Supply</p>
                </div>
            </div>
        </div>
        
        <nav class="py-4">
            <a href="dashboard.html" class="nav-item"><span>ğŸ“Š</span><span>×“×©×‘×•×¨×“</span></a>
            <a href="suppliers.html" class="nav-item"><span>ğŸ­</span><span>×¡×¤×§×™×</span></a>
            <a href="trips.html" class="nav-item"><span>âœˆï¸</span><span>× ×¡×™×¢×•×ª</span></a>
            <a href="products.html" class="nav-item"><span>ğŸ“¦</span><span>××•×¦×¨×™×</span></a>
            <a href="customers.html" class="nav-item"><span>ğŸ‘¥</span><span>×œ×§×•×—×•×ª</span></a>
            <a href="orders.html" class="nav-item"><span>ğŸ“‹</span><span>×”×–×× ×•×ª</span></a>
            <a href="invoices.html" class="nav-item active"><span>ğŸ§¾</span><span>×—×©×‘×•× ×™×•×ª</span></a>
            <a href="inventory.html" class="nav-item"><span>ğŸ“¦</span><span>××œ××™</span></a>
            <a href="agents-management.html" class="nav-item"><span>ğŸ¤</span><span>×¡×•×›× ×™×</span></a>
            <a href="reports.html" class="nav-item"><span>ğŸ“ˆ</span><span>×“×•×—×•×ª</span></a>
            <a href="maintenance.html" class="nav-item"><span>âš™ï¸</span><span>×ª×—×–×•×§×”</span></a>
        </nav>
        
        <div class="absolute bottom-0 w-full p-4 border-t border-gray-700">
            <div class="text-gray-400 text-sm mb-2" id="welcomeUser"></div>
            <button onclick="logout()" class="w-full bg-red-500 text-white py-2 rounded-lg hover:bg-red-600 transition flex items-center justify-center gap-2">
                <span>ğŸšª</span><span>×”×ª× ×ª×§</span>
            </button>
        </div>
    </aside>

    <!-- ×ª×•×›×Ÿ ×¨××©×™ -->
    <div class="main-content">
        <main class="p-6">

        <div class="flex justify-between items-center mb-6 no-print">
            <div>
                <h2 class="text-2xl font-bold text-gray-800">×—×©×‘×•× ×™×•×ª ×•×ª×¢×•×“×•×ª ××©×œ×•×—</h2>
                <p class="text-gray-500 text-sm">×›×œ ×”××¡××›×™× ×©×”×•×¤×§×• ×‘××¢×¨×›×ª</p>
            </div>
            
            <!-- ×¤×™×œ×˜×¨×™× -->
            <div class="flex gap-2">
                <select id="filterType" onchange="loadInvoices()" class="border rounded-lg px-3 py-2 text-sm">
                    <option value="">×›×œ ×”×¡×•×’×™×</option>
                    <option value="invoice">×—×©×‘×•× ×™×•×ª</option>
                    <option value="delivery_note">×ª×¢×•×“×•×ª ××©×œ×•×—</option>
                </select>
            </div>
        </div>

        <!-- ×˜×‘×œ×ª ×—×©×‘×•× ×™×•×ª -->
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden no-print">
            <div id="loading" class="p-8 text-center text-gray-500">×˜×•×¢×Ÿ × ×ª×•× ×™×...</div>
            <div id="emptyMessage" class="p-8 text-center text-gray-500 hidden">××™×Ÿ ××¡××›×™× ×‘××¢×¨×›×ª</div>
            <table id="invoicesTable" class="w-full hidden">
                <thead class="bg-gray-800 text-white">
                    <tr>
                        <th class="px-4 py-3 text-right">×ª××¨×™×š</th>
                        <th class="px-4 py-3 text-right">××¡' ××¡××š</th>
                        <th class="px-4 py-3 text-right">××¡' ×”×–×× ×”</th>
                        <th class="px-4 py-3 text-right">×œ×§×•×—</th>
                        <th class="px-4 py-3 text-right">×¡×•×’</th>
                        <th class="px-4 py-3 text-right">×¡×›×•×</th>
                        <th class="px-4 py-3 text-center">×¤×¢×•×œ×•×ª</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>

        <div id="printArea" class="hidden"></div>

        </main>
    </div>

    <!-- ××•×“××œ ×¦×¤×™×™×” ×‘××¡××š -->
    <div id="viewModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 class="text-xl font-bold" id="viewModalTitle">×¦×¤×™×™×” ×‘××¡××š</h3>
                <button onclick="closeViewModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <div id="viewModalContent" class="p-4">
                <!-- ×ª×•×›×Ÿ ×”××¡××š ×™×•×¦×’ ×›××Ÿ -->
            </div>
            <div class="flex justify-end gap-2 p-4 border-t">
                <button onclick="closeViewModal()" class="bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500">×¡×’×•×¨</button>
                <button onclick="printFromModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">ğŸ–¨ï¸ ×”×“×¤×¡</button>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://fpsvrqlviyrcifimfcby.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZwc3ZycWx2aXlyY2lmaW1mY2J5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzOTIzNDAsImV4cCI6MjA4MDk2ODM0MH0.RDRDYCFD4PatNRzKwSzdQg__ZWhIyu4OUq0O8kdrqdE';
        let supabaseClient = null;
        let invoices = [];
        let currentExchangeRate = 3.22;
        let currentInvoiceForPrint = null;

        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        window.onload = function() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true' || sessionStorage.getItem('isLoggedIn') === 'true';
            if (!isLoggedIn) { window.location.href = 'index.html'; return; }
            const username = localStorage.getItem('username') || sessionStorage.getItem('username') || '××©×ª××©';
            document.getElementById('welcomeUser').textContent = '×©×œ×•×, ' + username;
            if (typeof supabase !== 'undefined') {
                supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                loadInvoices();
            }
        };

        async function loadInvoices() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('invoicesTable').classList.add('hidden');
            document.getElementById('emptyMessage').classList.add('hidden');
            
            const filterType = document.getElementById('filterType').value;
            
            let query = supabaseClient
                .from('invoices')
                .select('*, customers(company_name), orders(order_number, total_amount)')
                .order('created_at', { ascending: false });
            
            if (filterType) {
                query = query.eq('type', filterType);
            }
            
            const { data, error } = await query;
            
            if (error) { 
                document.getElementById('loading').textContent = '×©×’×™××”: ' + error.message; 
                return; 
            }
            
            invoices = data || [];
            renderTable();
        }

        function getTypeBadge(type) {
            if (type === 'invoice') {
                return '<span class="px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">×—×©×‘×•× ×™×ª</span>';
            } else if (type === 'delivery_note') {
                return '<span class="px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">×ª.××©×œ×•×—</span>';
            }
            return '<span class="px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">×œ× ×™×“×•×¢</span>';
        }

        function renderTable() {
            document.getElementById('loading').classList.add('hidden');
            
            if (invoices.length === 0) { 
                document.getElementById('emptyMessage').classList.remove('hidden'); 
                return; 
            }
            
            document.getElementById('invoicesTable').classList.remove('hidden');
            document.getElementById('tableBody').innerHTML = invoices.map((inv, i) => {
                const orderAmount = inv.orders?.total_amount || inv.total_amount || 0;
                const printCount = inv.print_count || 0;
                
                return `
                <tr class="${i % 2 === 0 ? 'bg-white' : 'bg-gray-50'} hover:bg-yellow-50">
                    <td class="px-4 py-3">${inv.invoice_date || ''}</td>
                    <td class="px-4 py-3 font-semibold">${inv.invoice_number || ''}</td>
                    <td class="px-4 py-3">${inv.orders?.order_number || ''}</td>
                    <td class="px-4 py-3">${inv.customers?.company_name || ''}</td>
                    <td class="px-4 py-3">${getTypeBadge(inv.type)}</td>
                    <td class="px-4 py-3 font-bold">$${orderAmount}</td>
                    <td class="px-4 py-3">
                        <div class="flex gap-2 justify-center">
                            <button onclick="viewDocument('${inv.id}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">
                                ğŸ‘ï¸ ×¦×¤×™×™×”
                            </button>
                            <button onclick="printDocument('${inv.id}')" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600">
                                ğŸ–¨ï¸ ×”×“×¤×¡×” ${printCount > 0 ? `(${printCount})` : ''}
                            </button>
                        </div>
                    </td>
                </tr>
            `}).join('');
        }

        // ×¦×¤×™×™×” ×‘××¡××š
        async function viewDocument(invoiceId) {
            const inv = invoices.find(x => x.id === invoiceId);
            if (!inv) return;
            
            currentInvoiceForPrint = inv;
            
            // ×˜×¢×™× ×ª ×¤×¨×˜×™ ×”×”×–×× ×”
            const { data: orderData } = await supabaseClient
                .from('orders')
                .select('*, customers(company_name, contact_name, address, phone)')
                .eq('id', inv.order_id)
                .single();
            
            const { data: items } = await supabaseClient.from('order_items').select('*').eq('order_id', inv.order_id);
            
            const order = orderData;
            const customer = order?.customers;
            
            const isInvoice = inv.type === 'invoice';
            const title = isInvoice ? '×—×©×‘×•× ×™×ª ××¡ / ×§×‘×œ×”' : '×ª×¢×•×“×ª ××©×œ×•×—';
            const printCount = inv.print_count || 0;
            const copyLabel = printCount === 0 ? '××§×•×¨' : `×”×¢×ª×§ ${printCount}`;
            
            let totalAmount = 0;
            const itemsHtml = (items || []).map((item, i) => {
                const unitPrice = isInvoice ? (item.unit_price || 0) * currentExchangeRate : (item.unit_price || 0);
                const totalPrice = (item.quantity || 0) * unitPrice;
                totalAmount += totalPrice;
                const currency = isInvoice ? 'â‚ª' : '$';
                return `
                    <tr style="background: ${i % 2 === 0 ? '#fff' : '#f8f9fa'};">
                        <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${i + 1}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${item.product_type || '×©×™×¢×¨'}</td>
                        <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${item.quantity}</td>
                        <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${currency}${unitPrice.toFixed(2)}</td>
                        <td style="padding: 10px; border: 1px solid #ddd; text-align: center; font-weight: bold;">${currency}${totalPrice.toFixed(2)}</td>
                    </tr>
                `;
            }).join('');
            
            let summaryHtml = '';
            if (isInvoice) {
                const vat = totalAmount * 0.18;
                const total = totalAmount + vat;
                summaryHtml = `
                    <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                        <div style="width: 250px; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>×¡×”"×› ×œ×¤× ×™ ××¢"×:</span>
                                <span>â‚ª${totalAmount.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>××¢"× (18%):</span>
                                <span>â‚ª${vat.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: bold; border-top: 2px solid #d4af37; padding-top: 10px;">
                                <span>×¡×”"×› ×œ×ª×©×œ×•×:</span>
                                <span>â‚ª${total.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                summaryHtml = `
                    <div style="text-align: left; margin-top: 20px; font-size: 18px; font-weight: bold;">
                        ×¡×”"×›: $${totalAmount.toFixed(2)}
                    </div>
                `;
            }
            
            document.getElementById('viewModalTitle').textContent = `${title} ××¡' ${inv.invoice_number}`;
            document.getElementById('viewModalContent').innerHTML = `
                <div style="font-family: 'Heebo', sans-serif; direction: rtl;">
                    <!-- ×›×•×ª×¨×ª ×¢× ××§×•×¨/×”×¢×ª×§ -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #d4af37; padding-bottom: 15px;">
                        <div>
                            <h1 style="font-size: 24px; color: #1a1a2e; margin: 0;">${title} ××¡' ${inv.invoice_number}</h1>
                            <p style="color: #666; margin: 5px 0;">×ª××¨×™×š: ${inv.invoice_date || ''}</p>
                        </div>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span style="background: ${printCount === 0 ? '#10B981' : '#3B82F6'}; color: white; padding: 6px 16px; border-radius: 6px; font-weight: bold;">${copyLabel}</span>
                            <img src="logo.jpeg" style="width: 60px; height: 60px; object-fit: contain;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <strong>×¤×¨×˜×™ ×œ×§×•×—:</strong><br>
                            <strong>×©×:</strong> ${customer?.company_name || ''}<br>
                            <strong>××™×© ×§×©×¨:</strong> ${customer?.contact_name || ''}<br>
                            <strong>×›×ª×•×‘×ª:</strong> ${customer?.address || ''}<br>
                            <strong>×˜×œ×¤×•×Ÿ:</strong> ${customer?.phone || ''}
                        </div>
                        <div style="background: #e8f4fd; padding: 12px; border-radius: 8px;">
                            <strong>×¤×¨×˜×™ ×”×–×× ×”:</strong><br>
                            <strong>××¡' ×”×–×× ×”:</strong> ${order?.order_number || ''}<br>
                            <strong>×ª××¨×™×š ×”×–×× ×”:</strong> ${order?.order_date || ''}
                        </div>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px;">
                        <thead>
                            <tr style="background: #1a1a2e; color: white;">
                                <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">#</th>
                                <th style="padding: 10px; text-align: right; border: 1px solid #ddd;">××•×¦×¨</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">×›××•×ª</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">××—×™×¨</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">×¡×”"×›</th>
                            </tr>
                        </thead>
                        <tbody>${itemsHtml}</tbody>
                    </table>
                    
                    ${summaryHtml}
                    
                    ${order?.notes ? `<div style="margin-top: 15px; padding: 12px; background: #fff3cd; border-radius: 8px;"><strong>×”×¢×¨×•×ª:</strong> ${order.notes}</div>` : ''}
                </div>
            `;
            
            document.getElementById('viewModal').classList.remove('hidden');
        }

        function closeViewModal() {
            document.getElementById('viewModal').classList.add('hidden');
            currentInvoiceForPrint = null;
        }

        // ×”×“×¤×¡×” ××”××•×“××œ
        async function printFromModal() {
            if (!currentInvoiceForPrint) return;
            await printDocument(currentInvoiceForPrint.id);
        }

        // ×”×“×¤×¡×” ×™×©×™×¨×”
        async function printDocument(invoiceId) {
            const inv = invoices.find(x => x.id === invoiceId);
            if (!inv) return;
            
            // ×¢×“×›×•×Ÿ ××•× ×” ×”×“×¤×¡×•×ª
            const newPrintCount = (inv.print_count || 0) + 1;
            await supabaseClient.from('invoices').update({ print_count: newPrintCount }).eq('id', invoiceId);
            
            // ×˜×¢×™× ×ª ×¤×¨×˜×™ ×”×”×–×× ×”
            const { data: orderData } = await supabaseClient
                .from('orders')
                .select('*, customers(company_name, contact_name, address, phone)')
                .eq('id', inv.order_id)
                .single();
            
            const { data: items } = await supabaseClient.from('order_items').select('*').eq('order_id', inv.order_id);
            
            const order = orderData;
            const customer = order?.customers;
            
            const isInvoice = inv.type === 'invoice';
            const title = isInvoice ? '×—×©×‘×•× ×™×ª ××¡ / ×§×‘×œ×”' : '×ª×¢×•×“×ª ××©×œ×•×—';
            const copyLabel = `×”×¢×ª×§ ${newPrintCount}`;
            
            let totalAmount = 0;
            const itemsHtml = (items || []).map((item, i) => {
                const unitPrice = isInvoice ? (item.unit_price || 0) * currentExchangeRate : (item.unit_price || 0);
                const totalPrice = (item.quantity || 0) * unitPrice;
                totalAmount += totalPrice;
                const currency = isInvoice ? 'â‚ª' : '$';
                return `
                    <tr style="background: ${i % 2 === 0 ? '#fff' : '#f8f9fa'};">
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">${i + 1}</td>
                        <td style="padding: 12px; border: 1px solid #ddd;">${item.product_type || '×©×™×¢×¨'}</td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">${item.quantity}</td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">${currency}${unitPrice.toFixed(2)}</td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center; font-weight: bold;">${currency}${totalPrice.toFixed(2)}</td>
                    </tr>
                `;
            }).join('');
            
            let summaryHtml = '';
            if (isInvoice) {
                const vat = totalAmount * 0.18;
                const total = totalAmount + vat;
                summaryHtml = `
                    <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                        <div style="width: 280px; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>×¡×”"×› ×œ×¤× ×™ ××¢"×:</span>
                                <span>â‚ª${totalAmount.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>××¢"× (18%):</span>
                                <span>â‚ª${vat.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 20px; font-weight: bold; border-top: 2px solid #d4af37; padding-top: 10px;">
                                <span>×¡×”"×› ×œ×ª×©×œ×•×:</span>
                                <span>â‚ª${total.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                summaryHtml = `
                    <div style="text-align: left; margin-top: 20px; font-size: 20px; font-weight: bold;">
                        ×¡×”"×›: $${totalAmount.toFixed(2)}
                    </div>
                `;
            }
            
            const printArea = document.getElementById('printArea');
            printArea.innerHTML = `
                <div style="padding: 40px; font-family: 'Heebo', sans-serif; direction: rtl;">
                    <!-- ×›×•×ª×¨×ª ×¢× ×”×¢×ª×§ -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 2px solid #d4af37; padding-bottom: 20px;">
                        <div>
                            <h1 style="font-size: 28px; color: #1a1a2e; margin: 0;">${title} ××¡' ${inv.invoice_number}</h1>
                            <p style="color: #666; margin: 5px 0;">×ª××¨×™×š: ${inv.invoice_date || ''}</p>
                        </div>
                        <div style="display: flex; align-items: center; gap: 20px;">
                            <span style="background: #3B82F6; color: white; padding: 8px 20px; border-radius: 8px; font-weight: bold; font-size: 18px;">${copyLabel}</span>
                            <img src="logo.jpeg" style="width: 80px; height: 80px; object-fit: contain;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <strong>×¤×¨×˜×™ ×œ×§×•×—:</strong><br>
                            <strong>×©×:</strong> ${customer?.company_name || ''}<br>
                            <strong>××™×© ×§×©×¨:</strong> ${customer?.contact_name || ''}<br>
                            <strong>×›×ª×•×‘×ª:</strong> ${customer?.address || ''}<br>
                            <strong>×˜×œ×¤×•×Ÿ:</strong> ${customer?.phone || ''}
                        </div>
                        <div style="background: #e8f4fd; padding: 15px; border-radius: 8px;">
                            <strong>×¤×¨×˜×™ ×”×–×× ×”:</strong><br>
                            <strong>××¡' ×”×–×× ×”:</strong> ${order?.order_number || ''}<br>
                            <strong>×ª××¨×™×š ×”×–×× ×”:</strong> ${order?.order_date || ''}
                        </div>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                        <thead>
                            <tr style="background: #1a1a2e; color: white;">
                                <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">#</th>
                                <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">××•×¦×¨</th>
                                <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">×›××•×ª</th>
                                <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">××—×™×¨</th>
                                <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">×¡×”"×›</th>
                            </tr>
                        </thead>
                        <tbody>${itemsHtml}</tbody>
                    </table>
                    
                    ${summaryHtml}
                    
                    ${order?.notes ? `<div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px;"><strong>×”×¢×¨×•×ª:</strong> ${order.notes}</div>` : ''}
                </div>
            `;
            
            printArea.classList.remove('hidden');
            window.print();
            printArea.classList.add('hidden');
            
            // ×¨×¢× ×•×Ÿ ×”×˜×‘×œ×”
            loadInvoices();
            closeViewModal();
        }

        function logout() { 
            localStorage.clear(); 
            sessionStorage.clear(); 
            window.location.href = 'index.html'; 
        }
    </script>
</body>
</html>
